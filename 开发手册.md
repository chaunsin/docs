# 开发手册

本文主要罗列出开发中得一些代码规范、错误、或者坑、随笔等等。

# 接口

### 1. 开发需要主要接口幂等性要求,特别是在特殊严格场景、比如支付场景不能重复支付。

### 2. 状态修改场景

比如实名认证场景功能,用户对应有三种状态 1:未审核 2:审核通过 3:
审核拒绝。后台管理员对用户进行实名审核,现实中管理员可能不只有一个可能有多个,OK假如此刻有两个管理员对同一用户进行权限审核,两个管理员看到得是同一用户数据并且都在同一个页面,此时A用户对用户进行审核通过,前端提示审核成功,此时另一个用户B也在同一个页面,由于一些事情没有立即审核,并且没有刷新页面,此时用户B回过头点击审核拒绝,此时前端提示审核成功，过了一段时间用户反馈我得身份认证怎么还没有通过,最后管理人员一堆扯皮拉上测试或者开发一起定位问题,最后发现是因为B用户审核时看到得数据是未审核之前得旧值,造成修改数据覆盖。
解决方案:

1. 此问题得方式是采用状态机判断、修改之前进行数据查询逻辑判断,此种方式适用于并发不高得场景。
2. 采用乐观锁思想。以旧状态值作为修改条件进行修改,或者以旧状态值作为修改条件进行修改,修改成功row
   affect返回1则代表成功返回0则代表没有查询到数据或者,修改得值和原来得旧值一样。
3. 如果数据库中表结构已经确定,没有能作为乐观锁得场景,或者状态场景,还可以使用分布式锁+逻辑判断得方式。