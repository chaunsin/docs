# TIFF 图像文件格式

> - 说明：以下内容来自ai生成，部分内容拼凑而来，有错误请指正
> - 时间: 2025-10-14
> - 作者: chaunsin

![tiff.png](image/tiff.png)

来自: https://exiv2.org/book/index.html#TIFF

# 🧭 一、TIFF 是什么？

TIFF 全称是 Tagged Image File Format，即“带标签的图像文件格式”。
它由 Aldus（后来被 Adobe 收购）与微软在 1986 年共同制定，是一种灵活的、基于标签（Tag-based）结构的图像容器格式。

TIFF 不是一种压缩算法，而是一种数据容器格式（Data Container Format），它的核心思想是：

> 📦「一张图片的数据（像素 + 元信息）由一系列带标签的条目（Tag Entry）描述，每个标签定义一种数据内容（尺寸、色彩模型、分辨率、EXIF
> 信息、GPS 等等）。」

这就是它名字里 “Tagged” 的含义。理解「TIFF 格式」是理解 **EXIF、RAW、图像元数据**结构的根基。

# 📁 二、TIFF 的文件结构（最核心）

TIFF文件格式简单来说由：`TIFF 文件头 + 多个 IFD 表（Image File Directory）`构成。

TIFF 文件的逻辑结构由以下部分组成：

```text
+-------------------+
| TIFF Header       | → 指明字节序大小端、版本、首个 IFD 偏移
+-------------------+
| IFD #0            | → Image File Directory（核心）
|   + Tag 1         | → 例如 ImageWidth
|   + Tag 2         | → 例如 ImageLength
|   + Tag 3         | → 例如 Compression
|   ...             |
|   + NextIFDPtr -->| → 若有多页（多图像）
+-------------------+
| IFD #1 (Thumbnail)| → 缩略图 IFD
| ...               |
+-------------------+
| IFD #n            | → 其他IFD信息
| ...               |
+-------------------+
```

IFD 说明：

- IFD0：主图像（Full Image）
- IFD1：缩略图（Thumbnail Image）
- 有时还有 SubIFD（SubImage，如RAW预览）

在 **IFD1** 中，常见的字段有：

| 标签                                 | 含义               |
|------------------------------------|------------------|
| 0x0103 Compression                 | 通常为 6，代表 JPEG 压缩 |
| 0x0201 JPEGInterchangeFormat       | 缩略图在文件中的偏移地址     |
| 0x0202 JPEGInterchangeFormatLength | 缩略图的字节长度         |

> 💡提示：Thumbnail缩略图实际上是嵌入在图像文件尾部的一小段 JPEG 数据，可以单独提取并保存为 .jpg 文件。

## 🔹 TIFF Header 头部结构（8 字节固定）

| 偏移 | 长度      | 含义                                        |
|----|---------|-------------------------------------------|
| 0  | 2 bytes | 字节序标识：II（Intel，小端）或 MM（Motorola，大端）       |
| 2  | 2 bytes | 固定值 0x002A（42，代表 TIFF 魔数）                 |
| 4  | 4 bytes | 第一个 IFD（Image File Directory）的偏移（相对于文件开头） |

更多可以参考：https://exiv2.org/book/index.html#TIFF

## 🔹 IFD（Image File Directory）

TIFF 的核心数据结构。

每个 IFD = 一张图片（或一层）。
IFD 包含若干个 Directory Entry（目录项 / 标签项）。

一个典型的 IFD 结构如下：

```text
+--------------------+
| EntryCount (2B)    | → 标签数，例如 12 个
+--------------------+
| Entry 1 (12B)      |
| Entry 2 (12B)      |
| ...                |
+--------------------+
| NextIFDOffset (4B) | → 下一个 IFD 的偏移（0 表示没有）
+--------------------+
```

## 🔹 Directory Entry（每个 12 字节）

每个标签的Entry结构：

| 偏移 | 	长度     | 	含义                                   |
|----|---------|---------------------------------------|
| 0	 | 2 bytes | 	Tag ID（标签编号，例如 0x0100 表示 ImageWidth） |
| 2	 | 2 bytes | 	Type（数据类型）                           |
| 4	 | 4 bytes | 	Count（有多少个值）                         |
| 8	 | 4 bytes | 	Value or Offset（值或值的偏移地址）            |

数据类型|（Type）有以下几种（TIFF 固定定义）：

| Type | 名称        | 每项字节数 | 含义             |
|------|-----------|-------|----------------|
| 1    | BYTE      | 1     | 无符号 8 位整型      |
| 2    | ASCII     | 1     | ASCII 字符串      |
| 3    | SHORT     | 2     | 无符号 16 位整型     |
| 4    | LONG      | 4     | 无符号 32 位整型     |
| 5    | RATIONAL  | 8     | 两个 LONG（分子/分母） |
| 6    | SBYTE     | 1     | 有符号 8 位整型      |
| 7    | UNDEFINED | 1     | 未定义字节          |
| 8    | SSHORT    | 2     | 有符号 16 位整型     |
| 9    | SLONG     | 4     | 有符号 32 位整型     |
| 10   | SRATIONAL | 8     | 有符号有理数         |
| 11   | FLOAT     | 4     | IEEE 32 位浮点数   |
| 12   | DOUBLE    | 8     | IEEE 64 位浮点数   |

# 🧱 三、常见的 TIFF 标签（Tag）

| Tag ID | 名称                | 含义                 | 数据类型       |
|--------|-------------------|--------------------|------------|
| 0x0100 | ImageWidth        | 图像宽度               | SHORT/LONG |      
| 0x0101 | ImageLength       | 图像高度               | SHORT/LONG |      
| 0x0102 | BitsPerSample     | 每像素通道位数            | SHORT      |      
| 0x0103 | Compression       | 压缩方式（1=无压缩，6=JPEG） | SHORT      |      
| 0x010E | ImageDescription  | 图像描述               | ASCII      |      
| 0x010F | Make              | 相机品牌               | ASCII      |      
| 0x0110 | Model             | 相机型号               | ASCII      |      
| 0x0112 | Orientation       | 图像方向               | SHORT      |      
| 0x0131 | Software          | 生成软件               | ASCII      |      
| 0x0132 | DateTime          | 文件修改时间             | ASCII      |      
| 0x013B | Artist            | 作者                 | ASCII      |      
| 0x829A | ExposureTime      | 曝光时间               | RATIONAL   |      
| 0x829D | FNumber           | 光圈值                | RATIONAL   |      
| 0x8827 | ISOSpeedRatings   | ISO 感光度            | SHORT      |      
| 0x9003 | DateTimeOriginal  | 拍摄时间               | ASCII      |      
| 0x9004 | DateTimeDigitized | 数码化时间              | ASCII      |      
| 0x8769 | ExifIFDPointer    | EXIF IFD 偏移        | LONG       |      
| 0x8825 | GPSInfoIFDPointer | GPS IFD 偏移         | LONG       |      

其他tag可参考：https://exiftool.org/TagNames/EXIF.html

# 🌍 四、EXIF = “TIFF + 扩展标签”

TIFF 是 EXIF 的技术基础格式。
EXIF 其实就是：

> 📸「在 JPEG 文件的 APP1 段中嵌入一段符合 TIFF 结构的二进制块。」

这段块内部有：

- 一个标准的 TIFF Header（II 2A 00 开头）
- 一个或多个 IFD（Image File Directory）
- 常规的 TIFF 标签 + EXIF 扩展标签（0x8769 指向 EXIF IFD，0x8825 指向 GPS IFD）

例如：

```swift
APP1 (EXIF) Segment:
    "Exif\0\0" + [TIFF Header + IFDs]
```

所以：

> EXIF 不是独立格式，而是 基于 TIFF IFD 结构存储在 JPEG 内部的元数据块。

更多查看：[2.EXIF.md](2.EXIF.md)

# 🧮 五、GeoTIFF、BigTIFF、DNG 等衍生格式

## 🔸 GeoTIFF

在 TIFF 上添加地理坐标信息（如地图投影、地理参考），用于遥感/卫星影像。

## 🔸 BigTIFF

BigTiff 和 TIFF 的架构相同。BigTiff 基于 64 位。因此，大多数 uint16_t 数据类型会转换为 uint32_t，而 uint32_t 数据类型会转换为
uint64_t。
BigTiff 还支持三种额外的 8 字节类型：`Long8`、`SLong8` 和 `Ifd8`。

## 🔸 DNG（Digital Negative）

Adobe 定义的 RAW 图像标准格式，本质是 TIFF + 自定义 EXIF + 厂商 RAW 数据块。
DNG 文件结构完全兼容 TIFF，只是定义了额外的 Tag。

# 🧩 六、为什么 TIFF 被称为“容器格式”

TIFF 支持：

- 多页图像（多 IFD）
- 多种压缩方式（无压缩、LZW、JPEG、PackBits、ZIP）
- 任意自定义 Tag（厂商可定义 Private Tag，比如 Nikon、Canon 的 MakerNote）
- 嵌入任意类型的元数据（EXIF、XMP、GPS）

这意味着 TIFF 不只是一个“图片”，而是一个通用的“结构化图像文件容器”。

# 🧠 七、总结对比表（与 EXIF/IPTC/XMP 的关系）

| 特性   | TIFF            | EXIF             | IPTC          | XMP                  |
|------|-----------------|------------------|---------------|----------------------|
| 定义者  | Aldus/Adobe     | JEITA (日本电子工业协会) | IPTC (新闻行业)   | Adobe                |
| 存储结构 | 二进制、基于IFD       | TIFF 派生          | 二进制块 (IIM)    | XML (RDF)            |
| 数据内容 | 图像 + 元数据        | 拍摄参数             | 新闻描述文本        | 可扩展的 RDF 元数据         |
| 文件位置 | 独立文件            | JPEG APP1 段内     | JPEG APP13 段内 | JPEG APP1 段或 sidecar |
| 可扩展性 | 中等（需定义 Tag）     | 中等               | 低             | 高（命名空间机制）            |
| 可读性  | 二进制             | 二进制              | 二进制           | 文本 XML               |
| 应用   | 专业图像、扫描、RAW、DNG | 相机照片             | 新闻机构          | 编辑系统、数字资产管理          |

# 📚 八、TIFF 的实际应用场景

| 场景      | 说明                                   |
|---------|--------------------------------------|
| 扫描件     | 高精度、无损压缩（LZW/ZIP），常用于档案扫描。           |
| 医学影像    | 多页 TIFF 存储切片。                        |
| 地理信息    | GeoTIFF 用于卫星遥感图像。                    |
| 数码相机    | RAW 许多 RAW 格式基于 TIFF（如 DNG、NEF、CR2）。 |
| 图片元数据容器 | EXIF 的底层结构。                          |

# 🧩 九、总结一句话记忆：

TIFF 是一种通用的、基于标签的二进制容器格式，允许灵活地存储图像和任意元数据。
EXIF 其实就是嵌入 JPEG 内部、以 TIFF 格式组织的相机元数据结构。

# 参考

- https://help.accusoft.com/ImageGear-Net/v22.1/Windows/HTML/topic367.html TIFF元数据结构介绍
