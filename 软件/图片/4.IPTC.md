# IPTC(International Press Telecommunications Council)

> - 说明：以下内容来自ai生成，部分内容拼凑而来，有错误请指正
> - 时间: 2025-10-14
> - 作者: chaunsin


要真正理解 IPTC（特别是传统的 **IPTC IIM 格式**），
必须先搞清楚它的**底层数据结构**是什么样的

---

# 🧩 一、IPTC 的核心格式标准：IIM（Information Interchange Model）

IPTC 的底层数据格式叫做：

> **IPTC IIM (Information Interchange Model)**
> 中文：信息交换模型格式

这是一种**非常早期的二进制标记结构**（诞生于 1991 年），
用来存储“字段号 + 长度 + 数据”类型的记录。

它不像 EXIF（基于 TIFF Tag + Offset）那么复杂，
而是一个**线性二进制流**结构，非常类似 TLV（Tag-Length-Value）。

---

# 🧠 二、IPTC 的数据基本单元：DataSet

每个字段（比如 Title、Keywords、Caption）都存放在一个 **DataSet** 结构里。
每个 DataSet 的字节结构如下：

| 字节段            | 长度       | 含义                               |
|----------------|----------|----------------------------------|
| Tag Marker     | 1 字节     | 固定为 `0x1C`（表示 IPTC 数据开始）         |
| Record Number  | 1 字节     | 表示类别（如 2 表示“Application Record”） |
| Dataset Number | 1 字节     | 表示字段号（如 5 表示 ObjectName）         |
| Data Length    | 2 或 4 字节 | 表示后续数据的长度（支持短长两种格式）              |
| Data           | N 字节     | 实际字段内容（字符串、二进制等）                 |

---

### 📘 举个例子：

假设我们要保存一个标题（Title = “Sunset in Tokyo”）

该字段对应 IPTC 的 **Record 2, Dataset 5 (2:05)**
即 ObjectName（标题）

#### 那么它的字节结构可能是：

| 字节序列                                           | 含义                       |
|------------------------------------------------|--------------------------|
| `1C`                                           | IPTC 标志位（固定）             |
| `02`                                           | Record 2：应用层记录           |
| `05`                                           | Dataset 5：ObjectName（标题） |
| `00 0F`                                        | 长度 15（后面字符串长度）           |
| `53 75 6E 73 65 74 20 69 6E 20 54 6F 6B 79 6F` | 数据本体："Sunset in Tokyo"   |

也就是（十六进制）：

```
1C 02 05 00 0F 53 75 6E 73 65 74 20 69 6E 20 54 6F 6B 79 6F
```

解释：

| 段                 | 含义        |
|-------------------|-----------|
| 1C                | 标志        |
| 02                | Record 2  |
| 05                | Dataset 5 |
| 000F              | 长度 15     |
| “Sunset in Tokyo” | 数据内容      |

---

# 🧱 三、Data Length（长度）编码方式

长度字段默认使用 **2 字节无符号整数（big endian）**。

但如果最高位为 `0x80`（即长度 > 32767），则使用“扩展长度”模式：

* 如果第一个字节 = 0x80，则后面的一个字节表示有多少个字节来存长度；
* 后续那几个字节组合成实际长度。

例子（扩展长度）：

```
1C 02 120 80 04 00 00 04 D2 [data...]
```

表示长度字段用了 4 字节，实际长度为 0x04D2 = 1234 字节。

---

# 📚 四、完整 IPTC 记录的结构

一个完整的 IPTC 数据块是多个 DataSet 连续存储。

例如：

| DataSet           | 含义                                 |
|-------------------|------------------------------------|
| (2:05) ObjectName | "Sunset in Tokyo"                  |
| (2:25) Keywords   | "Sunset"                           |
| (2:25) Keywords   | "City"                             |
| (2:80) Byline     | "Chaunsin"                         |
| (2:120) Caption   | "A photo taken at sunset in Tokyo" |

那么它的二进制流就类似于：

```
1C 02 05 00 0F 53 75 6E 73 65 74 20 69 6E 20 54 6F 6B 79 6F
1C 02 19 00 06 53 75 6E 73 65 74
1C 02 19 00 04 43 69 74 79
1C 02 50 00 08 43 68 61 75 6E 73 69 6E
1C 02 78 00 22 41 20 70 68 6F 74 6F 20 74 61 6B 65 6E 20 61 74 20 73 75 6E 73 65 74 20 69 6E 20 54 6F 6B 79 6F
```

> 注意：不同字段是直接连续存放的，没有额外的分隔符。

---

# 📦 五、IPTC 如何嵌入 JPEG 图片中

JPEG 文件由多个 **APP 段**组成，例如：

| 段名        | 用途                       |
|-----------|--------------------------|
| APP0      | JFIF Header              |
| APP1      | EXIF                     |
| APP2      | ICC Profile              |
| **APP13** | **IPTC / Photoshop IRB** |
| APP14     | Adobe 颜色信息               |

---

## APP13 段中 IPTC 的封装方式：

* APP13 由 Adobe Photoshop 定义，叫做 **Photoshop Image Resource Block (IRB)**。
* IRB 结构：

  ```
  'Photoshop 3.0' 00
  0x1C 02 05 ... (多个 IPTC 数据块)
  ```
* 所以在 JPEG 里，IPTC 实际是被封装在：

  ```
  [APP13 marker: FFED]
  -> "Photoshop 3.0" header
  -> N 个 IPTC DataSet
  ```

也就是说：

> **JPEG 本身不认识 IPTC**，是 Photoshop 定义了 APP13 容器，把 IPTC IIM 数据塞进去的。

APP13中得Photoshop Image Resource Block (IRB)详情介绍可参考：[5.Photoshop IRB.md](5.Photoshop%20IRB.md)

---

# 🔍 六、IPTC 与其他结构的区别（结构级）

| 格式         | 结构类型                   | 是否可嵌套      | 存储方式             |
|------------|------------------------|------------|------------------|
| EXIF       | IFD（表格 + 偏移）           | ✅ 可嵌套（指针式） | 偏移指针结构（类似小型文件系统） |
| XMP        | XML 文档                 | ✅ 无限嵌套     | UTF-8 文本结构       |
| IPTC (IIM) | TLV (Tag-Length-Value) | ❌ 扁平       | 顺序线性字节流          |

---

# 💡 七、编码注意点

* **字符集**：老版本 IPTC IIM 默认使用 ISO-8859-1 (Latin-1)；
  后来增加了 1:90 字段用于指明字符集（如 UTF-8）。
* **字段可重复**：例如 Keywords (2:25) 可以出现多次。
* **长度限制**：每个字段最大 32767 字节（标准定义）。
* **顺序不强制**：理论上字段顺序无关，但部分老工具假定特定顺序。

---

# 🧩 八、在现代图片文件中

现代元数据组合通常是：

| 文件格式        | 元数据内容             | 存储机制                                  |
|-------------|-------------------|---------------------------------------|
| JPEG        | EXIF + IPTC + XMP | APP1 (EXIF), APP13 (IPTC), APP1 (XMP) |
| TIFF        | EXIF + IPTC + XMP | IFD 中的 SubIFD 或 tag                   |
| PNG         | eXIf + iTXt + XMP | `eXIf` 块 + `iTXt` 块                   |
| WebP        | EXIF + XMP        | RIFF “EXIF” chunk                     |
| HEIF / AVIF | EXIF + XMP + IPTC | ISO BMFF boxes                        |

---

# 🧾 九、真实 IPTC 数据十六进制示例（截取）

以下是从一张 JPEG 文件中提取的 APP13 部分：

```
FF ED 0B 80 50 68 6F 74 6F 73 68 6F 70 20 33 2E 30 00 38 42 49 4D 04 04 ...
1C 02 05 00 0A 54 65 73 74 20 49 6D 61 67 65
1C 02 25 00 04 54 65 73 74
1C 02 78 00 0C 41 20 74 65 73 74 20 63 61 70 74 69 6F 6E
```

可以看到：

* `FFED` 是 APP13 marker；
* `"Photoshop 3.0"` 是标识；
* 后面是连续多个 `1C 02 xx` 的 IPTC 字段。

---

# ✅ 十、总结：IPTC IIM 格式结构总结表

| 字段             | 字节数   | 说明             |
|----------------|-------|----------------|
| Tag Marker     | 1     | 固定为 `0x1C`     |
| Record Number  | 1     | 记录类型（常用：2=应用层） |
| Dataset Number | 1     | 字段号（如 5=标题）    |
| Data Length    | 2 或扩展 | 数据长度           |
| Data           | 可变    | 实际内容（字符串、二进制）  |

> 一个 IPTC 数据块由多个这样的 DataSet 连续组成。

---

# ⚙️ 十一、扩展知识：IPTC IIM → XMP 的迁移机制

在 XMP 中，IPTC 字段不再使用 `1C 02` 开头的二进制格式，
而是直接写成 XML 元素，例如：

```xml

<photoshop:Headline>City Sunset</photoshop:Headline>
<dc:creator>Chaunsin</dc:creator>
<dc:subject>
<rdf:Bag>
    <rdf:li>sunset</rdf:li>
    <rdf:li>city</rdf:li>
</rdf:Bag>
</dc:subject>
```

所以现代标准建议：

> IPTC 的二进制格式主要用于兼容旧系统，
> 新系统应优先写入 XMP 格式（`Iptc4xmpCore` 命名空间）。

# 十二、扩展知识：IPTC-NAA和IPTC IIM有啥区别是一个东西么？

这个问题确实容易混淆，因为 “IPTC-NAA” 和 “IPTC IIM” 这两个名字在历史上指的是**同一体系的不同阶段**，而在现代文档和图片元数据处理中，它们通常是
**同义词或继承关系**。

我来给你详细、系统地讲清楚：

## 🧭 一、IPTC-NAA 是什么？

**IPTC-NAA** 是最早的全称之一：

> **IPTC-NAA Information Interchange Model (IIM)**
> 中文：国际新闻电讯委员会（IPTC）和美国新闻联盟（NAA）制定的信息交换模型。

* **IPTC**（International Press Telecommunications Council）是一个国际新闻技术标准组织。
* **NAA**（Newspaper Association of America，美国报业协会）是当时美国的新闻行业组织。

在上世纪 1980~1990 年代，两者联合制定了一个用于新闻图片、文字、数据交换的标准模型，最初称为：

> **IPTC-NAA Information Interchange Model (IIM)**
> 简称 **IPTC-NAA IIM**。

📅 **最早版本**大约是 1991 年正式发布（IIM 4.0）。
它定义了图片新闻的元数据结构，比如：

* 标题（Object Name）
* 作者（Byline）
* 说明（Caption / Abstract）
* 版权信息（Copyright Notice）
* 创建时间、编辑状态等

## 🧩 二、IPTC IIM 是什么？

后来，“IPTC-NAA Information Interchange Model” 太长了，人们在使用中就直接简称为：

> **IPTC IIM**
> 即 **IPTC Information Interchange Model**

它其实是 **IPTC-NAA IIM** 的简称/缩写演化形式。
换句话说：

> ✅ **IPTC-NAA IIM = IPTC IIM**
> 两者标准内容一致，只是命名简化了。

区别只在于时代和文件中引用方式：

* 老资料（1990s）常写 “IPTC-NAA IIM”。
* 新文档、库、JPEG规范中写 “IPTC IIM”。

## 🧠 三、从时代关系来看

| 时间       | 标准名称              | 说明                        |
|----------|-------------------|---------------------------|
| 1980s    | IPTC-NAA          | IPTC 与 NAA 联合制定早期新闻数据交换标准 |
| 1991     | IPTC-NAA IIM v4.0 | 定义了图片元数据结构（即 IIM 格式）      |
| 1990s 后期 | IPTC IIM          | IPTC 独立使用的简称              |
| 2001+    | XMP（Adobe）        | XML 格式的新一代元数据标准，逐渐替代 IIM  |

## 🖼 四、它在 JPEG 文件中的位置：APP13 / Photoshop IRB

在 JPEG 图片中，IPTC IIM 通常被封装在 Photoshop 的资源块（IRB）结构中：

```
JPEG APP13 segment:
  Photoshop IRB:
    8BIM (signature)
    Resource ID (e.g. 0x0404 = IPTC/NAA data)
    Pascal string name
    Size (4 bytes)
    Data (contains raw IPTC IIM binary)
```

也就是说：

* JPEG 的 **APP13 段** → Photoshop 的 **Image Resource Block (IRB)** 容器
* IRB 中有一个资源块 ID = `0x0404`
* 它的内容部分是 **IPTC IIM 二进制数据**

这个部分就是我们常说的：

> “IPTC metadata embedded in JPEG (APP13 Photoshop segment)”

## 🔗 五、IPTC IIM、Photoshop IRB、Photoshop Info 的关系

| 结构                                       | 含义                      | 层级位置       | 关系说明                  |
|------------------------------------------|-------------------------|------------|-----------------------|
| **JPEG APP13 segment**                   | JPEG 扩展块                | 最外层        | Photoshop 和 IPTC 都在这里 |
| **Photoshop IRB (Image Resource Block)** | Photoshop 的元数据容器        | APP13 内部   | 包含多个资源块               |
| **Resource ID 0x0404**                   | IPTC-NAA (IPTC IIM) 数据块 | IRB 内部     | 存 IPTC 数据（新闻元数据）      |
| **Resource ID 0x040C**                   | Photoshop Info 数据块      | IRB 内部     | 存 Photoshop 特定的说明信息   |
| **XMP**                                  | XML 元数据（新标准）            | 另存于 APP1 段 | 后来取代部分 IPTC           |

可以理解为：

> JPEG → APP13 → IRB → {IPTC(0x0404), Photoshop Info(0x040C), ...}


# 参考

- https://iptc.org/standards/ 官方网站